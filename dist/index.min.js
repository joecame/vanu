var vanu=function(){"use strict";return function(){var c=window,e=arguments[0]||{},l=e.baseController||"",i=e.base||"",s=e.timeout||300,d=e.target,f=e.parse||function(e){return Object.fromEntries(new c.URLSearchParams(e).entries())};"string"==typeof d&&(d=c.document.querySelector(d));function u(e,r){var a=Array.prototype.slice.call(r.childNodes),e=Array.prototype.slice.call(e.childNodes),t=a.length-e.length;if(0<t)for(;0<t;t--)a[a.length-t].parentNode.removeChild(a[a.length-t]);e.forEach(function(e,t){if(a[t])if(o(e)===o(a[t])){var n=x(e);if(n&&n!==x(a[t])&&(a[t].textContent=n),0<a[t].childNodes.length&&e.childNodes.length<1)a[t].innerHTML="";else{if(a[t].childNodes.length<1&&0<e.childNodes.length){n=c.document.createDocumentFragment();return u(e,n),void a[t].appendChild(n)}0<e.childNodes.length&&u(e,a[t])}}else a[t].parentNode.replaceChild(e.cloneNode(!0),a[t]);else r.appendChild(e.cloneNode(!0))})}function h(e){var t,e=(t=e(),(e=c.document.createElement("body")).innerHTML=t,e);u(e,d),m&&clearTimeout(m),N("vanu:end"),a(!0)}var p,v,m,g,_=[],y={},S=function(e,t){return t.render(function(){return""})},E="?v="+Date.now(),N=function(e){return c.dispatchEvent(new c.Event(e))},b=!0,o=function(e){return 3===e.nodeType?"text":8===e.nodeType?"comment":e.tagName.toLowerCase()},x=function(e){return e.childNodes&&0<e.childNodes.length?null:e.textContent},a=function(e){(e?d:c.document).querySelectorAll("[u-link]").forEach(function(n){n.handle=function(e){var t=n.getAttribute("href")||n.getAttribute("u-link");"#"===t?t="#/":t.startsWith("/#/")&&(t=t.substring(1)),e.preventDefault(),e.stopPropagation(),v!==t&&(c.history.pushState({},"",t),c.__uHandler())},n.addEventListener("click",n.handle)})},C={},D=0;c.__uEvent=function(e,t,n){return C[e].call(t,n)};function H(e){var t=v+(e.name||++D);return C[t]=e,"return __uEvent('".concat(t,"', this, event)")}return{routes:[],html:function(e){var r=[].slice.call(arguments,1);return e.reduce(function(e,t,n){n=r[n-1];return"function"==typeof n&&(n=H(n)),e+String(n)+t})},find:function(e){for(var t,n,r={},a=0,i=this.routes,u=i.length;a<u;){if((n=i[a]).rgx.test(e)){n.isParam&&(r=n.rgx.exec(e).groups||{}),t=n.fns;break}a++}return{fns:t,params:r}},on:function(e,t){return"vanu:error"===e?S=t:"vanu:start"!==e&&"vanu:end"!==e||c.addEventListener(e,t),this},handle:function(e,r){e||(m=setTimeout(function(){return N("vanu:start")},s)),p&&(p(),p=void 0);var t=r||c.location,n=t.pathname,e=t.search,t=t.hash,a=0;v=t?(n=("/"===(n="/"===n[n.length-1]?n.slice(0,-1):n)?"/":n+"/")+t.substring(2),t+e):n+e,C={},D=0;var n=this.find(n),i=n.fns,n=n.params,u=r||{url:v};u.isServer=b,u.params=n,u.query=u.query||(e?f(e.substring(1)):{}),u.html=this.html,u.go=function(e,t){return function(e){var t=1<arguments.length&&void 0!==arguments[1]?arguments[1]:"pushState",n=2<arguments.length?arguments[2]:void 0;c.history[t]({},"",e),c.__uHandler(n)}(e,t,!0)},u.unmount=function(e){return p=e,u},u.__uServerData&&(b?(e=(c.document.getElementById("__uServerData")||{}).textContent||u.__uServerData,u.initData="string"==typeof e?JSON.parse(e):e):u.initData=void 0),b=!1;function o(e){return e?S(e,u):i[a++](u,o)}u.render=u.render||function(e){h(g=e)},u.target=function(e){e&&(d="string"==typeof e?c.document.querySelector(e):e)},u.useValue=function(t){return{get value(){return t},set value(e){t=e,g&&h(g)}}},u.load=function(e,t){if(r)return r.loadScript(l+e)(u,o);if(e=-1!==(n=e).indexOf("?")?n.split("?")[0]:n,e=l+e,t=t||e.substring(e.lastIndexOf("/")+1).replace(".js",""),y[e])return c[t](u,o);y[e]=!0;var n=c.document.createElement("script");n.src=e+E,n.type="text/javascript",c.document.head.appendChild(n),n.onload=function(){return c[t](u,o)}},i=i||[function(e){return e.render(function(){return""})}],i=_.concat(i),o()},use:function(){return _=_.concat([].slice.call(arguments)),this},listen:function(e,n,r){var t=this;e?(r&&(e.__uServerData=r),e.res=e.res||n,e.pathname=e.path||e.url.split("?")[0],e.loadScript=e.loadScript||function(e){return require(__baseClient+e)},e.render=function(e){d.innerHTML=e(),!c.document.getElementById("__uServerData")&&r&&((t=c.document.createElement("script")).id="__uServerData",t.setAttribute("type","application/json"),t.append(JSON.stringify(r)),c.document.head.appendChild(t));var t=c.document.documentElement.outerHTML;if(n.send)return n.send(t);n.setHeader("Content-Type","text/html; charset=utf-8"),n.end(t)},this.handle(!0,e)):(c.__uHandler||(c.__uHandler=function(e){return t.handle(e)}),c.__uHandler(),a(),c.addEventListener("popstate",function(){v!==c.location.hash&&c.__uHandler()}))},get:function(e){e=i+e;var t,n,r=[].slice.call(arguments,1),a=r[r.length-1];"object"==typeof a&&(r=r.slice(0,-1).concat([(t=a.controller,n=a.name,function(e){return(0,e.load)(l+t,n)})]));a=-1!==e.indexOf("/:");return e=e.replace(/\/$/,"").replace(/:(\w+)(\?)?(\.)?/g,"$2(?<$1>[^/]+)$2$3"),/\*|\./.test(e)&&(e=e.replace(/(\/?)\*/g,"($1.*)?").replace(/\.(?=[\w(])/,"\\.")),this.routes.push({fns:r,rgx:new RegExp("^".concat(e,"/*$")),isParam:a}),this}}}}();
