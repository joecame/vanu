var vanu=function(){"use strict";return function(){var l=window,e=arguments[0]||{},t=l.document.querySelector("base"),c=e.baseController||"",i=t?t.getAttribute("href"):"";"/"===(i=e.base?e.base:i)&&(i="");var s=e.timeout||300,d=e.target,f=e.parse||function(e){return Object.fromEntries(new l.URLSearchParams(e).entries())};"string"==typeof d&&(d=l.document.querySelector(d));function h(e,o){var c=Array.prototype.slice.call(o.childNodes),e=Array.prototype.slice.call(e.childNodes),t=c.length-e.length;if(0<t)for(;0<t;t--)c[c.length-t].parentNode.removeChild(c[c.length-t]);e.forEach(function(e,t){if(c[t])if(D(e)===D(c[t])){if(e.attributes&&e.attributes.length)for(var n=0,r=e.attributes.length;n<r;){var a,i=e.attributes[n];!i.name||(a=C(e,i.name)||"")!==(C(c[t],i.name)||"")&&("false"===a?c[t].removeAttribute(i.name):c[t][i.name]=a),n++}var u=C(e);if(u&&u!==C(c[t])&&(c[t].textContent=u),0<c[t].childNodes.length&&e.childNodes.length<1)c[t].innerHTML="";else{if(c[t].childNodes.length<1&&0<e.childNodes.length){u=l.document.createDocumentFragment();return h(e,u),void c[t].appendChild(u)}0<e.childNodes.length&&h(e,c[t])}}else c[t].parentNode.replaceChild(e.cloneNode(!0),c[t]);else o.appendChild(e.cloneNode(!0))})}function p(e){var t,e=(t=e(),(e=l.document.createElement("div")).innerHTML=t,e);h(e,d),e=e.querySelector("[u-link]"),g&&clearTimeout(g),N("vanu:end"),e&&!x&&u(!0)}var v,m,g,_,y=[],S={},b=function(e,t){return t.render(function(){return""})},E="?v="+Date.now(),N=function(e){return l.dispatchEvent(new l.Event(e))},x=!0,D=function(e){return 3===e.nodeType?"text":8===e.nodeType?"comment":e.tagName.toLowerCase()},C=function(e,t){return t?"string"!=typeof e[t]?e.getAttribute(t):e[t]:e.childNodes&&0<e.childNodes.length?null:e.textContent},u=function(e){(e?d:l.document).querySelectorAll("[u-link]").forEach(function(t){t.handle=function(e){e.preventDefault(),e.stopPropagation();e=t.getAttribute("href")||t.getAttribute("u-link");m!==e&&(l.history.pushState({},"",e),l.__uHandler())},t.addEventListener("click",t.handle)})},H={},T=0;l.__uEvent=function(e,t,n){return H[e].call(t,n)};function a(e){var t=e.name||++T;return H[t]=e,"return __uEvent('".concat(t,"', this, event)")}return{routes:[],html:function(e){var r=[].slice.call(arguments,1);return e.reduce(function(e,t,n){n=r[n-1];return"function"==typeof n&&(n=a(n)),e+String(n)+t})},find:function(e){for(var t,n,r={},a=0,i=this.routes,u=i.length;a<u;){if((n=i[a]).rgx.test(e)){n.isParam&&(r=n.rgx.exec(e).groups||{}),t=n.fns;break}a++}return{fns:t,params:r}},on:function(e,t){return"vanu:error"===e?b=t:"vanu:start"!==e&&"vanu:end"!==e||l.addEventListener(e,t),this},handle:function(e,r){e||(g=setTimeout(function(){return N("vanu:start")},s)),v&&(v(),v=void 0);var t=r||l.location,n=t.pathname,e=t.search,t=t.hash,a=0;m=t?(n=("/"===(n="/"===n[n.length-1]?n.slice(0,-1):n)?"/":n+"/")+t.substring(2),t+e):n+e,H={},T=0;var n=this.find(n),i=n.fns,n=n.params,u=r||{url:m};u.isServer=x,u.params=n,u.query=u.query||(e?f(e.substring(1)):{}),u.html=this.html,u.go=function(e,t){return function(e){var t=1<arguments.length&&void 0!==arguments[1]?arguments[1]:"pushState",n=2<arguments.length?arguments[2]:void 0;l.history[t]({},"",e),l.__uHandler(n)}(e,t,!0)},u.unmount=function(e){return v=e,u},x?u.__uServerData?u.initServerData=u.__uServerData:l.document.getElementById("__uServerData")&&(u.initServerData=JSON.parse(l.document.getElementById("__uServerData").textContent)):u.initServerData=void 0;function o(e){return e?b(e,u):i[a++](u,o)}u.render=u.render||function(e){p(_=e)},u.target=function(e){e&&(d="string"==typeof e?l.document.querySelector(e):e)},u.useValue=function(t){return{get value(){return t},set value(e){t=e,_&&p(_)}}},u.load=function(e,t){if(r)return r.loadScript(c+e)(u,o);if(e=-1!==(n=e).indexOf("?")?n.split("?")[0]:n,e=c+e,t=t||e.substring(e.lastIndexOf("/")+1).replace(".js",""),S[e])return l[t](u,o);S[e]=!0;var n=l.document.createElement("script");n.src=e+E,n.type="text/javascript",l.document.head.appendChild(n),n.onload=function(){return l[t](u,o)}},i=i||[function(e){return e.render(function(){return""})}],i=y.concat(i),o(),x=!1},use:function(){return y=y.concat([].slice.call(arguments)),this},listen:function(e,n,r,a){var t=this;e?(x=!0,r&&(e.__uServerData=r),e.res=e.res||n,e.pathname=e.path||e.url.split("?")[0],e.loadScript=e.loadScript||function(e){return require(__baseClient+e)},e.render=e.render||function(e){var t=e();d.innerHTML=t;e=l.document.documentElement.outerHTML.replace("{{INIT_SERVER_DATA}}",r?'<script id="__uServerData" type="application/json">'.concat(JSON.stringify(r),"<\/script>"):"");return a?a(e,t):n.send?n.send(e):(n.setHeader("Content-Type","text/html; charset=utf-8"),void n.end(e))},this.handle(!0,e)):(l.__uHandler||(l.__uHandler=function(e){return t.handle(e)}),l.__uHandler(),u(),l.addEventListener("popstate",function(){m!==l.location.hash&&l.__uHandler()}))},get:function(e){e=i+e;var t,n,r=[].slice.call(arguments,1),a=r[r.length-1];"object"==typeof a&&(r=r.slice(0,-1).concat([(t=a.controller,n=a.name,function(e){return(0,e.load)(t,n)})]));a=-1!==e.indexOf("/:");return e=e.replace(/\/$/,"").replace(/:(\w+)(\?)?(\.)?/g,"$2(?<$1>[^/]+)$2$3"),/\*|\./.test(e)&&(e=e.replace(/(\/?)\*/g,"($1.*)?").replace(/\.(?=[\w(])/,"\\.")),this.routes.push({fns:r,rgx:new RegExp("^".concat(e,"/*$")),isParam:a}),this}}}}();
